version: "3.8"

services:
  vendor-a:
    image: node:18-alpine
    container_name: marketplace-vendor-a
    restart: unless-stopped
    working_dir: /app
    volumes:
      - ./vendor-a:/app
      - /app/node_modules
    command: sh -c "npm install && npm start"
    networks:
      - homeserver-net
    ports:
      - "3001:3000"
    environment:
      - API_SECRET=${API_SECRET}

  vendor-b:
    image: node:18-alpine
    container_name: marketplace-vendor-b
    restart: unless-stopped
    working_dir: /app
    volumes:
      - ./vendor-b:/app
      - /app/node_modules
    command: sh -c "npm install && npm start"
    networks:
      - homeserver-net
    ports:
      - "3002:3000"
    environment:
      - API_SECRET=${API_SECRET}

  vendor-c:
    image: node:18-alpine
    container_name: marketplace-vendor-c
    restart: unless-stopped
    working_dir: /app
    volumes:
      - ./vendor-c:/app
      - /app/node_modules
    command: sh -c "npm install && npm start"
    networks:
      - homeserver-net
    ports:
      - "3003:3000"
    environment:
      - API_SECRET=${API_SECRET}

  integrator:
    image: node:18-alpine
    container_name: marketplace-integrator
    restart: unless-stopped
    working_dir: /app
    volumes:
      - ./integrator:/app
      - /app/node_modules
    command: sh -c "npm install && npm start"
    ports:
      - "3000:3000"
    networks:
      - homeserver-net
    environment:
      - VENDOR_A_URL=http://vendor-a:3000
      - VENDOR_B_URL=http://vendor-b:3000
      - VENDOR_C_URL=http://vendor-c:3000
      - API_SECRET=${API_SECRET}

networks:
  homeserver-net:
    external: true
    name: srv_homeserver-net
